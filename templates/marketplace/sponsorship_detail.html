{% extends 'base.html' %}

{% block title %}Sponsorship Details - {{ sponsorship.title }}{% endblock %}

{% block content %}
<div class="container py-5">
    <h1>Sponsorship Proposal: {{ sponsorship.title }}</h1>

    {% if messages %}
        {% for message in messages %}
            <div class="alert alert-{{ message.tags }}">{{ message }}</div>
        {% endfor %}
    {% endif %}

    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Proposal Details</h5>
            <p class="card-text"><strong>Farmer:</strong> {{ sponsorship.farmer.profile.user.get_full_name }}</p>
            <p class="card-text"><strong>Title:</strong> {{ sponsorship.title }}</p>
            <p class="card-text"><strong>Description:</strong> {{ sponsorship.description }}</p>
            <p class="card-text"><strong>Amount Requested:</strong> ${{ sponsorship.amount_requested }}</p>
            <p class="card-text"><strong>Expected Yield:</strong> {{ sponsorship.expected_yield }}</p>
            <p class="card-text"><strong>Expected Completion Date:</strong> {{ sponsorship.expected_completion_date|date:"F j, Y" }}</p>
            <p class="card-text"><strong>Status:</strong> {{ sponsorship.status }}</p>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Sponsor Information</h5>
            <p class="card-text"><strong>Sponsor Name:</strong> {{ sponsor_info.name }}</p>
            <p class="card-text"><strong>Organization:</strong> {{ sponsor_info.organization }}</p>
            <p class="card-text"><strong>Contact:</strong> {{ sponsor_info.contact }}</p>
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Milestones</h5>
            {% if milestones %}
                <ul class="list-group">
                    {% for milestone in milestones %}
                        <li class="list-group-item">
                            {{ milestone.title }} - {{ milestone.status }} (Due: {{ milestone.due_date|date:"F j, Y" }})
                            {% if milestone.verification_notes %}
                                <p class="text-muted">Notes: {{ milestone.verification_notes }}</p>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No milestones defined.</p>
            {% endif %}
        </div>
    </div>

    <div class="card mb-3">
        <div class="card-body">
            <h5 class="card-title">Payments</h5>
            {% if payments %}
                <ul class="list-group">
                    {% for payment in payments %}
                        <li class="list-group-item">
                            {{ payment.payment_type }} - ${{ payment.amount }} (Date: {{ payment.payment_date|date:"F j, Y" }})
                            {% if payment.transaction_id %}
                                <p class="text-muted">Transaction ID: {{ payment.transaction_id }}</p>
                            {% endif %}
                        </li>
                    {% endfor %}
                </ul>
            {% else %}
                <p>No payments recorded.</p>
            {% endif %}
        </div>
    </div>

    <a href="{% url 'marketplace:notification_list' %}" class="btn btn-secondary mt-3">Back to Notifications</a>
</div>
{% endblock %}